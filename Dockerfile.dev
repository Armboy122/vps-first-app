# ใช้ Node.js Debian-based (แก้ปัญหา Prisma + OpenSSL)
FROM node:18-slim

# อัปเดตและติดตั้ง dependencies ที่จำเป็น
RUN apt-get update && apt-get install -y \
    openssl \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# สร้างโฟลเดอร์ทำงาน
WORKDIR /app

# ก๊อปปี้ package.json และ package-lock.json
COPY package.json package-lock.json* ./

# ติดตั้ง dependencies ด้วย npm
RUN npm ci

# ก๊อปปี้โค้ดทั้งหมด
COPY . .

# Generate Prisma Client
RUN npx prisma generate

# สร้าง production build
RUN npm run build

# ตั้งค่าพอร์ตให้เป็น 3002
ENV PORT=3002

# เปิดพอร์ต 3002
EXPOSE 3002

# รันแอป
CMD ["npm", "start"]
